
<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between sm:items-start">
    <div>
      <h1 class="text-3xl font-bold text-text-primary dark:text-slate-100">{{ t.title() }}</h1>
      <p class="mt-1 text-sm text-text-secondary dark:text-slate-400">{{ t.summary() }}</p>
    </div>
    <button (click)="dataService.seedData()" class="mt-4 sm:mt-0 px-4 py-2 bg-primary text-primary-foreground font-medium rounded-md hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
      {{ t.create() }}
    </button>
  </div>

  <!-- Filters -->
  <div class="space-y-4">
    <div class="flex flex-wrap items-center gap-2">
      <button (click)="statusFilter.set('all')" [class]="statusFilter() === 'all' ? 'bg-primary text-white' : 'bg-card dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600'" class="px-3 py-1 text-sm font-semibold border border-slate-300 dark:border-slate-600 rounded-full">{{ t.filter_all() }}</button>
      @for(status of ['Draft', 'Sent', 'Viewed', 'Negotiation', 'Accepted']; track status) {
        <button (click)="statusFilter.set(status)" [class]="statusFilter() === status ? 'bg-primary text-white' : 'bg-card dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600'" class="px-3 py-1 text-sm font-semibold border border-slate-300 dark:border-slate-600 rounded-full">{{ getStatusInfo(status).text }}</button>
      }
    </div>
    <div class="flex flex-col sm:flex-row gap-4">
      <div class="relative flex-grow">
          <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
          </div>
          <input type="text" [value]="searchTerm()" (input)="searchTerm.set($any($event.target).value)" [placeholder]="t.search_placeholder()" class="block w-full rounded-md border-border dark:border-slate-600 bg-card dark:bg-slate-700 pl-10 text-text-primary dark:text-slate-200 shadow-sm sm:text-sm h-10">
      </div>
      <div class="flex items-center space-x-2 flex-shrink-0">
         <button (click)="quickFilter.set('needs_follow_up')" [class]="quickFilter() === 'needs_follow_up' ? 'bg-primary-light dark:bg-indigo-900/40 text-primary dark:text-indigo-300' : 'text-text-secondary dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700'" class="px-3 py-1.5 text-sm font-medium rounded-md">{{t.quick_filter_needs_follow_up()}}</button>
         <button (click)="quickFilter.set('viewed_recently')" [class]="quickFilter() === 'viewed_recently' ? 'bg-primary-light dark:bg-indigo-900/40 text-primary dark:text-indigo-300' : 'text-text-secondary dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700'" class="px-3 py-1.5 text-sm font-medium rounded-md">{{t.quick_filter_viewed_recently()}}</button>
         <button (click)="quickFilter.set('expiring_soon')" [class]="quickFilter() === 'expiring_soon' ? 'bg-primary-light dark:bg-indigo-900/40 text-primary dark:text-indigo-300' : 'text-text-secondary dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700'" class="px-3 py-1.5 text-sm font-medium rounded-md">{{t.quick_filter_expiring_soon()}}</button>
      </div>
    </div>
  </div>

  <!-- Table or Empty State -->
  @if (dataService.proposals().length > 0) {
    <div class="bg-card dark:bg-slate-800 rounded-lg shadow-sm border border-border dark:border-slate-700 overflow-x-auto">
      <table class="min-w-full divide-y divide-border dark:divide-slate-700">
        <thead class="bg-slate-50 dark:bg-slate-900/50">
          <tr>
            <th scope="col" class="w-2/6 px-6 py-3 text-left text-xs font-medium text-text-secondary dark:text-slate-400 uppercase tracking-wider">{{t.head_client()}}</th>
            <th scope="col" class="w-1/6 px-6 py-3 text-left text-xs font-medium text-text-secondary dark:text-slate-400 uppercase tracking-wider">{{t.head_value()}}</th>
            <th scope="col" class="w-1/6 px-6 py-3 text-left text-xs font-medium text-text-secondary dark:text-slate-400 uppercase tracking-wider">{{t.head_status()}}</th>
            <th scope="col" class="w-1/6 px-6 py-3 text-left text-xs font-medium text-text-secondary dark:text-slate-400 uppercase tracking-wider">{{t.head_engagement()}}</th>
            <th scope="col" class="w-2/6 px-6 py-3 text-left text-xs font-medium text-text-secondary dark:text-slate-400 uppercase tracking-wider">{{t.head_last_activity()}}</th>
            <th scope="col" class="relative px-6 py-3"><span class="sr-only">{{t.head_actions()}}</span></th>
          </tr>
        </thead>
        <tbody class="bg-card dark:bg-slate-800 divide-y divide-border dark:divide-slate-700">
          @for(proposal of filteredProposals(); track proposal.id) {
            <tr class="group relative hover:bg-slate-50 dark:hover:bg-slate-700/50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-text-primary dark:text-slate-200">{{ proposal.leadName }}</div>
                <div class="flex items-center space-x-2 mt-1">
                  <span class="text-xs text-text-secondary dark:text-slate-400">{{ t.version(proposal.version) }}</span>
                  @if (proposal.isLatest) {
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary-light text-primary dark:bg-indigo-900/50 dark:text-indigo-300">{{t.latest()}}</span>
                  }
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-text-primary dark:text-slate-200">${{ proposal.value.toLocaleString() }}</div>
                <div class="text-xs text-text-secondary dark:text-slate-400">{{ getDealStage(proposal.dealId) }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" [class]="getStatusInfo(proposal.status).classes">{{ getStatusInfo(proposal.status).text }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-text-secondary dark:text-slate-400">
                @if(proposal.viewCount > 0) {
                  <div>{{ t.engagement_viewed(proposal.viewCount) }}</div>
                  <div class="text-xs">{{ t.engagement_last_viewed(getTimeSince(proposal.lastViewedAt)) }}</div>
                } @else {
                  <span>-</span>
                }
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                 <div class="text-sm text-text-primary dark:text-slate-300">{{ getLastActivity(proposal) }}</div>
                 <div class="flex items-center space-x-2 mt-1">
                    @for(signal of proposal.aiSignals; track signal) {
                       <div [class]="getSignalInfo(signal).classes" [innerHTML]="getSignalInfo(signal).icon + getSignalInfo(signal).text"></div>
                    }
                 </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <div class="relative inline-block text-left">
                    <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                        <div class="absolute right-0 bottom-0 mb-2 w-48 bg-card dark:bg-slate-900 border border-border dark:border-slate-700 rounded-md shadow-lg z-10 hidden group-hover:block">
                            <div class="py-1" role="menu" aria-orientation="vertical">
                                <a href="#" (click)="handleAction('open', proposal, $event)" class="block px-4 py-2 text-sm text-text-primary dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800">{{t.action_open()}}</a>
                                <a href="#" (click)="handleAction('copyLink', proposal, $event)" class="block px-4 py-2 text-sm text-text-primary dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800">{{t.action_copy_link()}}</a>
                                <a href="#" (click)="handleAction('followUp', proposal, $event)" class="block px-4 py-2 text-sm text-text-primary dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800">{{t.action_follow_up()}}</a>
                                <div class="border-t border-border dark:border-slate-700 my-1"></div>
                                <a href="#" (click)="handleAction('duplicate', proposal, $event)" class="block px-4 py-2 text-sm text-text-primary dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800">{{t.action_duplicate()}}</a>
                                @if(proposal.status === 'Accepted') {
                                  <a href="#" (click)="handleAction('generateContract', proposal, $event)" class="block px-4 py-2 text-sm text-green-600 dark:text-green-400 hover:bg-slate-100 dark:hover:bg-slate-800">{{t.action_generate_contract()}}</a>
                                }
                            </div>
                        </div>
                        <button class="p-2 rounded-full text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700">
                          <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" /></svg>
                        </button>
                    </div>
                </div>
              </td>
            </tr>
          }
          @if (filteredProposals().length === 0) {
              <tr>
                <td colspan="6">
                  <div class="p-8 text-center text-text-secondary dark:text-slate-400">
                      <h3 class="text-lg font-medium text-text-primary dark:text-slate-200">{{t.filter_empty_title()}}</h3>
                      <p class="text-sm mt-1">{{t.filter_empty_subtitle()}}</p>
                      <button (click)="statusFilter.set('all'); quickFilter.set('all'); searchTerm.set('')" class="mt-4 px-3 py-1 text-sm font-semibold bg-primary text-white rounded-full">{{t.clear_filters()}}</button>
                  </div>
                </td>
              </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="p-12 text-center text-text-secondary dark:text-slate-400 bg-card dark:bg-slate-800 rounded-lg shadow-sm border-2 border-dashed border-border dark:border-slate-700">
        <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
        <h3 class="mt-2 text-lg font-medium text-text-primary dark:text-slate-200">{{t.empty_title()}}</h3>
        <p class="text-sm mt-1">{{t.empty_subtitle()}}</p>
        <div class="mt-6">
            <button (click)="dataService.seedData()" class="px-4 py-2 bg-primary text-primary-foreground font-medium rounded-md hover:bg-primary-hover">{{ t.create() }}</button>
        </div>
    </div>
  }
</div>
